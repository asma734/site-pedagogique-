<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>API et AJAX - Cours JS</title>
  <style>
    body {
      background-color: rgb(255, 227, 196);
      font-family: Arial, sans-serif;
      margin: 5px;
      line-height: 1.5;
      transform: scale(0.96);
      transform-origin: center;
    }

    h1 {
      color: rgb(255, 102, 0);
      text-align: center;
      margin: 10px 0;
    }

    h2, h3, h4 {
      font-family: 'Lobster', cursive;
      margin: 10px 0;
    }

    img {
      display: block;
      margin: 10px auto;
      border-radius: 10px;
    }

    pre {
      background-color: #ad7772;
      border-radius: 20px;
      padding: 10px;
      border-left: 5px solid #8f1f1f;
      overflow-x: auto;
    }

    ul {
      background-color: #f2c9b8;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    li {
      margin-bottom: 15px;
    }

    code {
      background-color: #fedbcf;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: "Courier New", monospace;
    }

    a {
      color: #24ab36;
      text-decoration: none;
      font-weight: bold;
    }

    a:hover {
      text-decoration: underline;
    }

    button {
      display: block;
      margin: 20px auto;
      background-color: #ffa64d;
      color: rgb(0, 0, 0);
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #ff8800;
    }

    hr {
      border: none;
      border-top: 2px dashed #999;
      margin: 30px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background-color: #fff8e1;
    }

    table, th, td {
      border: 1px solid #ccc;
    }

    thead {
      background-color: #ffc061;
    }

    .commentaire {
      color: green;
      font-family: "Courier New", monospace;
      font-style: italic;
    }

    th, td {
      padding: 10px;
      text-align: left;
    }
  </style>
</head>

<body>
<h1>ğŸ’¡ Cours complet sur les API et AJAX</h1>

<section style="background-color: #eef6ff; padding: 20px; border-radius: 10px; margin-top: 30px;">
  <h2>ğŸ”Œ Quâ€™est-ce quâ€™une API ?</h2>
  <img src="api.ex2.png" width="700" alt="API diagram">

  <p>Une <strong>API</strong> (Application Programming Interface) est une <strong>interface de communication</strong> entre deux programmes. Elle permet Ã  une application web (comme ton site HTML/JS) de <strong>parler avec un serveur</strong> Ã  distance pour obtenir ou envoyer des donnÃ©es.</p>

  <h3>ğŸ§  Exemple concret :</h3>
  <p>Ton site veut connaÃ®tre la mÃ©tÃ©o Ã  Tunis â†’ il envoie une requÃªte Ã  une <strong>API mÃ©tÃ©o</strong> qui renvoie une rÃ©ponse.</p>

  <pre><code>// RequÃªte HTTP
GET https://api.weatherapi.com/v1/current.json?q=Tunis

// RÃ©ponse JSON
{
  "location": {
    "name": "Tunis",
    "country": "Tunisia"
  },
  "current": {
    "temp_c": 33.5,
    "condition": {
      "text": "EnsoleillÃ©"
    }
  }
}</code></pre>

  <h3>ğŸ¯ Pourquoi utiliser une API ?</h3>
  <ul>
    <li>ğŸ“Š Pour obtenir des donnÃ©es dynamiques (mÃ©tÃ©o, cours boursiers, actualitÃ©s...)</li>
    <li>ğŸ“· Pour intÃ©grer des services (YouTube, Google Maps, etc.)</li>
    <li>âš™ï¸ Pour crÃ©er des applications modernes et interactives</li>
  </ul>

  <h3>ğŸ¥ VidÃ©o explicative :</h3>
  <p><a href="https://www.youtube.com/watch?v=Px1nU6W5GfY" target="_blank">"C'est quoi une API ?" â€“ par Grafikart (6 min)</a></p>
</section>

<section style="background-color:#f0f9ff; border-radius: 10px; padding: 20px; margin-top: 30px;">
  <h2>ğŸ“¡ Partie 2 â€“ Comment JavaScript utilise une API ?</h2>

  <h3>ğŸ” Ã‰tapes simples :</h3>
  <ol>
    <li>Tu utilises <code>fetch(URL)</code> pour envoyer une requÃªte.</li>
    <li>Tu reÃ§ois une rÃ©ponse au format <code>JSON</code>.</li>
    <li>Tu affiches les donnÃ©es dans ta page avec JavaScript.</li>
  </ol>

  <h3>ğŸ’» Les principales instructions utilisÃ©es :</h3>
  <ul>
    <li><code>fetch(...)</code> : Fonction JS pour <strong>envoyer une requÃªte HTTP</strong> Ã  une API.<br><em>Â« HÃ© API, donne-moi une blague ! Â»</em></li>
    <li><code>https://official-joke-api.appspot.com/random_joke</code> : L'<strong>URL</strong> de l'API, qui renvoie une blague au format JSON.</li>
    <li><code>.then(response => response.json())</code> : On transforme la rÃ©ponse reÃ§ue en <strong>objet lisible en JS</strong>.</li>
    <li><code>.then(data => { ... })</code> : On <strong>utilise les donnÃ©es reÃ§ues</strong> pour les afficher dans la page.</li>
  </ul>

  <h3>ğŸ“¦ Ce que fait lâ€™API (et ce quâ€™elle ne fait pas)</h3>
  <table>
    <tr><th>Action</th><th>Fait par lâ€™API ?</th><th>DÃ©tail</th></tr>
    <tr><td>Fournit une blague</td><td>âœ… Oui</td><td>Sa fonction</td></tr>
    <tr><td>Affiche la blague</td><td>âŒ Non</td><td>Ton JS le fait</td></tr>
    <tr><td>Envoie une rÃ©ponse JSON</td><td>âœ… Oui</td><td>Format standard</td></tr>
    <tr><td>Fait la requÃªte</td><td>âŒ Non</td><td>Câ€™est ton code</td></tr>
  </table>

  <h3>ğŸ Exemple pratique avec une API de blague :</h3>
  <button onclick="obtenirBlague()">Obtenir une blague ğŸ¤£</button>
  <p id="blagueAPI" style="font-size: 1.2em;"></p>

  <script>
    function obtenirBlague() {
      fetch("https://official-joke-api.appspot.com/random_joke")
        .then(response => response.json())
        .then(data => {
          document.getElementById("blagueAPI").innerHTML =
            "<strong>" + data.setup + "</strong><br>" + data.punchline;
        })
        .catch(error => {
          document.getElementById("blagueAPI").innerText = "Erreur : " + error;
        });
    }
  </script>

  <h3>ğŸ“Œ RÃ©sumÃ©</h3>
  <ul>
    <li>API = service distant</li>
    <li>fetch(URL) = envoie une requÃªte</li>
    <li>JSON = rÃ©ponse formatÃ©e</li>
    <li>JS = affiche les donnÃ©es</li>
  </ul>
</section>

<!-- NOUVELLE SECTION AJOUTÃ‰E -->

<section style="background-color:#ffffff; border-radius: 10px; padding: 20px; margin-top: 30px;">
  <h2>â“ Peut-on utiliser nâ€™importe quelle API ?</h2>
  <p>La rÃ©ponse est <strong>non</strong>, on ne peut pas utiliser nâ€™importe quelle API sans conditions. Voici les critÃ¨res essentiels :</p>
  <ul>
    <li><strong>AccÃ¨s autorisÃ© :</strong> lâ€™API doit Ãªtre publique ou tu dois avoir une clÃ© dâ€™accÃ¨s (token) fournie par le fournisseur.</li>
    <li><strong>CompatibilitÃ© technique :</strong> lâ€™API doit Ãªtre compatible avec ton environnement (langage, protocole HTTP/HTTPS, format des donnÃ©es comme JSON).</li>
    <li><strong>Respect des limites :</strong> respecter les quotas de requÃªtes imposÃ©s par lâ€™API (nombre de requÃªtes par minute/jour).</li>
    <li><strong>Conditions dâ€™utilisation :</strong> respecter les licences, les rÃ¨gles dâ€™usage et la protection des donnÃ©es personnelles.</li>
    <li><strong>SÃ©curitÃ© :</strong> Ã©viter les APIs non fiables qui peuvent prÃ©senter des risques pour la sÃ©curitÃ© et la confidentialitÃ©.</li>
  </ul>
  <p><em>En rÃ©sumÃ© :</em> on peut utiliser une API seulement si on a la permission, quâ€™elle est techniquement accessible et quâ€™on respecte les rÃ¨gles imposÃ©es.</p>

  <h2>â— Ã€ quoi sert une API ?</h2>
  <p>Une API (Application Programming Interface) est une interface qui permet Ã  deux logiciels de communiquer. GrÃ¢ce Ã  une API, tu peux :</p>
  <ul>
    <li><strong>RÃ©cupÃ©rer des donnÃ©es :</strong> par exemple, obtenir la mÃ©tÃ©o sans capteurs physiques.</li>
    <li><strong>Envoyer des donnÃ©es :</strong> par exemple, envoyer un message via un service externe.</li>
    <li><strong>ContrÃ´ler un service :</strong> par exemple, allumer une lumiÃ¨re Ã  distance avec une API domotique.</li>
    <li><strong>Automatiser des tÃ¢ches :</strong> comme rÃ©cupÃ©rer automatiquement tes opÃ©rations bancaires.</li>
    <li><strong>IntÃ©grer des fonctionnalitÃ©s tierces :</strong> comme un systÃ¨me de paiement ou une carte interactive.</li>
  </ul>
  <p><em>En rÃ©sumÃ© :</em> une API te donne accÃ¨s Ã  des services externes pour enrichir ou automatiser tes applications.</p>
  
  <section style="background-color:#fff9e6; border-radius: 10px; padding: 20px; margin-top: 30px;">
  <h2>âš™ï¸ Ã‰tapes dÃ©taillÃ©es du fonctionnement de <code>fetch()</code></h2>

  <h3>Ã‰tape 1 : Envoyer la requÃªte HTTP Ã  lâ€™URL</h3>
  <pre><code>fetch('https://api.example.com/data')</code></pre>
  <p>Ici, <code>fetch()</code> lance une requÃªte <strong>GET</strong> vers lâ€™URL spÃ©cifiÃ©e.</p>
  <p>Câ€™est un appel <em>asynchrone</em>, Ã§a dÃ©marre la demande vers le serveur.</p>

  <h3>Ã‰tape 2 : Recevoir la rÃ©ponse sous forme dâ€™un objet <code>Response</code></h3>
  <pre><code>fetch('https://api.example.com/data')
  .then(response =&gt; {
    // Ici, on reÃ§oit l'objet Response
    console.log(response);
  });</code></pre>
  <p>Le <code>.then()</code> permet dâ€™attendre que la requÃªte soit terminÃ©e et quâ€™on ait reÃ§u la rÃ©ponse.</p>
  <p><code>response</code> contient les mÃ©tadonnÃ©es et les donnÃ©es brutes.</p>

  <h3>Ã‰tape 3 : VÃ©rifier si la rÃ©ponse est correcte (statut HTTP)</h3>
  <pre><code>fetch('https://api.example.com/data')
  .then(response =&gt; {
    if (!response.ok) {  // response.ok est true si statut HTTP 200-299
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json(); // On passe Ã  lâ€™Ã©tape suivante pour lire les donnÃ©es
  })</code></pre>
  <p>On vÃ©rifie si la requÃªte a rÃ©ussi (code 2xx).</p>
  <p>Sinon, on lance une erreur pour la gÃ©rer.</p>

  <h3>Ã‰tape 4 : Extraire les donnÃ©es JSON de la rÃ©ponse</h3>
  <pre><code>fetch('https://api.example.com/data')
  .then(response =&gt; {
    if (!response.ok) {
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json(); // transforme la rÃ©ponse en objet JS
  })
  .then(data =&gt; {
    console.log(data); // ici, on a les donnÃ©es JSON prÃªtes Ã  Ãªtre utilisÃ©es
  });</code></pre>
  <p><code>response.json()</code> lit le corps de la rÃ©ponse et convertit le JSON en objet JS.</p>

  <h3>Ã‰tape 5 : Utiliser les donnÃ©es reÃ§ues dans le programme</h3>
  <pre><code>fetch('https://api.example.com/data')
  .then(response =&gt; {
    if (!response.ok) {
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json();
  })
  .then(data =&gt; {
    // Par exemple, afficher les donnÃ©es dans un Ã©lÃ©ment HTML
    document.getElementById('result').innerText = JSON.stringify(data, null, 2);
  });</code></pre>
  <p>On affiche ou traite les donnÃ©es dans la page.</p>

  <h3>Ã‰tape 6 : GÃ©rer les erreurs Ã©ventuelles</h3>
  <pre><code>fetch('https://api.example.com/data')
  .then(response =&gt; {
    if (!response.ok) {
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json();
  })
  .then(data =&gt; {
    document.getElementById('result').innerText = JSON.stringify(data, null, 2);
  })
  .catch(error =&gt; {
    console.error('Erreur attrapÃ©e :', error);
    document.getElementById('result').innerText = 'Erreur : ' + error.message;
  });</code></pre>
  <p><code>.catch()</code> permet de capturer les erreurs (problÃ¨me rÃ©seau, serveur, JSON invalide, etc.) et dâ€™afficher un message adaptÃ©.</p>

  <h3>RÃ©sumÃ© complet du code avec toutes les Ã©tapes</h3>
  <pre><code>fetch('https://api.example.com/data') // 1. Envoyer requÃªte HTTP
  .then(response =&gt; {                  // 2. Recevoir la rÃ©ponse
    if (!response.ok) {                  // 3. VÃ©rifier le statut HTTP
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json();              // 4. Extraire les donnÃ©es JSON
  })
  .then(data =&gt; {                     // 5. Utiliser les donnÃ©es
    document.getElementById('result').innerText = JSON.stringify(data, null, 2);
  })
  .catch(error =&gt; {                   // 6. GÃ©rer les erreurs
    console.error('Erreur attrapÃ©e :', error);
    document.getElementById('result').innerText = 'Erreur : ' + error.message;
  });</code></pre>
</section>

<section style="background-color:#fff1df; border-radius: 10px; padding: 20px; margin-top: 30px;">
  <h2>ğŸ”„ Conversion entre JSON et JavaScript</h2>

  <p>Une API envoie souvent les donnÃ©es sous forme de <strong>texte JSON brut</strong>. Pour pouvoir les manipuler en JavaScript, on doit <strong>les convertir</strong>.</p>

  <h3>ğŸ§  JSON â†’ JavaScript (lecture d'une rÃ©ponse)</h3>
  <pre><code>
let json = '{"nom": "Ali", "age": 22}';
let obj = JSON.parse(json); // RÃ©sultat : un objet JS
console.log(obj.nom); // Affiche : Ali
  </code></pre>
  <p>âœ”ï¸ <code>JSON.parse()</code> transforme une <strong>chaÃ®ne JSON</strong> en <strong>objet JavaScript</strong>.</p>

  <h3>ğŸ“¤ JavaScript â†’ JSON (prÃ©paration Ã  lâ€™envoi ou affichage)</h3>
  <pre><code>
let obj = { nom: "Ali", age: 22 };
let json = JSON.stringify(obj); // RÃ©sultat : '{"nom":"Ali","age":22}'
  </code></pre>
  <p>âœ”ï¸ <code>JSON.stringify()</code> transforme un <strong>objet JavaScript</strong> en <strong>chaÃ®ne JSON</strong>.</p>

  <h3>âœ¨ Et pour bien afficher dans une page ?</h3>
  <pre><code>
let obj = { nom: "Ali", age: 22 };
document.getElementById("zoneTexte").innerText = JSON.stringify(obj, null, 2);
  </code></pre>
  <p>
    ğŸ” L'option <code>null, 2</code> ajoute des <strong>espaces et des retours Ã  la ligne</strong> pour rendre le JSON lisible.
  </p>

  <h3>âš ï¸ Pourquoi câ€™est utile dans <code>fetch()</code> ?</h3>
  <ul>
    <li>âœ… Les donnÃ©es de lâ€™API sont au format JSON (brut, compact)</li>
    <li>âœ… On les transforme avec <code>response.json()</code> â†’ objet JS</li>
    <li>âœ… Pour les <strong>afficher proprement</strong> dans la page, on les retransforme avec <code>JSON.stringify(..., 2)</code></li>
  </ul>

  <h3>ğŸ” Exemple de chaÃ®ne JSON compacte vs lisible</h3>
  <table>
    <thead>
      <tr><th>Format</th><th>Texte JSON</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>MinifiÃ© (compact)</td>
        <td><code>{"nom":"Ali","age":22}</code></td>
      </tr>
      <tr>
        <td>Lisible (avec indentation)</td>
        <td>
<pre style="margin: 0; background-color: #fff6ca;">
{
  "nom": "Ali",
  "age": 22
}
</pre>
        </td>
      </tr>
    </tbody>
  </table>
</section>


</section>



<p><a href="exercice1.html">â¬…ï¸ Retour Ã  la premiÃ¨re partie</a></p>

</body>
</html>
